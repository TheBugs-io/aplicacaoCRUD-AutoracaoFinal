<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editar Usuário</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <main class="main-cadastro">
      <h1>Editar usuário</h1>
      <div class="group-pesquisa">
        <label for="uuid">ID de Usuário:</label>
        <input type="text" placeholder="UUID" name="uuid" id="uuid" />
        <button id="buscar" class="btn-submit">Pesquisar</button>
        <a href="../index.html" class="navegacao_paginas">Voltar para Lista</a>
      </div>

      <form id="formulario"></form>
    </main>
    <script>
      document.getElementById("buscar").addEventListener("click", async () => {
        const id = document.getElementById("uuid").value.trim();

        try {
          const response = await fetch(`/buscar-usuario/${id}`);
          if (!response.ok) {
            alert("Usuário não encontrado.");
            return;
          }

          const usuario = await response.json();

          document.getElementById("formulario").innerHTML = `
            <label for="nome">Nome:</label>
            <input type="text" name="nome" id="nome" value="${usuario.nome}" />
            <label for="idade">Idade:</label>
            <input type="number" name="idade" id="idade" value="${usuario.idade}" />
            <label for="endereco">Endereço:</label>
            <input type="text" name="endereco" id="endereco" value="${usuario.endereco}" />
            <label for="email">Email:</label>
            <input type="email" name="email" id="email" value="${usuario.email}" />
            <button type="submit">Salvar</button>
          `;

          document
            .getElementById("formulario")
            .addEventListener("submit", async (e) => {
              e.preventDefault();

              const dadosAtualizados = {
                nome: document.getElementById("nome").value,
                idade: parseInt(document.getElementById("idade").value),
                endereco: document.getElementById("endereco").value,
                email: document.getElementById("email").value,
              };

              const resposta = await fetch(`/atualizar-usuario/${id}`, {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(dadosAtualizados),
              });

              if (resposta.ok) {
                alert("Usuário atualizado com sucesso!");
              } else {
                alert("Erro ao atualizar usuário.");
              }
            });
        } catch (err) {
          alert("Erro na requisição.");
          console.error(err);
        }
      });
    </script>
  </body>
</html>
